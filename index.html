<!DOCTYPE html>
<html lang="en">
    <head>
        <title>OpenFileSystem Demonstration Page</title>

        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css">
        <link rel="stylesheet" href="static/style.css">

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
        <script src="static/ofs.js"></script>
        <!-- Latest compiled and minified JavaScript -->
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.2/js/bootstrap.min.js"></script>
        <script>
            $(function(){
                var box_client_id = "5fmnuoxq79novlted3hvo7jcc51a5zi6";
                var box = ofs.client('http://api.box.com/ofs');
                var msg = $("#auth-message");

                $("#auth-box").on("click", function(){
                    box.auth(box_client_id, function(err, fs) {
                        if (err) {
                            msg.show().text(err).addClass("alert-error").removeClass("alert-info");
                            return;
                        }

                        msg.show().text("Successfully authorized Box").addClass("alert-success").removeClass("alert-info").delay(2000).fadeOut();

                        $("#path").text("Loading root folder path...");
                        fs.stat('/', function(err, info) {
                            $("#path").text(info.path)
                        });
                        $("#loading-progress").show();

                        fs.listContents('/', function(err, contents) {
                            $("#loading-progress-bar").css("width", "100%");
                            $("#loading-progress").delay(2000).fadeOut();

                            var i = 0;
                            var dir = $("#directory-contents");
                            contents.forEach(function(item) {
                                var file = $("<div class='file col-md-2'></div>");
                                var icon = $("<img/>");
                                if (item.type == "application/folder") {
                                    icon.attr("src", "http://findicons.com/icon/download/64167/folder/128/png");
                                } else {
                                    icon.attr("src", "http://findicons.com/icon/download/203096/document/128/png");
                                }
                                file.append(icon);
                                file.append("<p class='filename'>" + item.filename + "</p>");
                                dir.append(file);
                                console.log(item);
                            });
                        });

                        /*
                        fs.getTemporaryUrl('/loi.pdf', function(err, url) {
                            var urlObject = {
                                url: "www.api.box.com/asdfadf_abvab",
                                expires: 1112413513 // unix time when it it will expire
                            }
                            console.log("URL for loi: ", url);
                        });
                        */
                    });
                });
            });
        </script>
    </head>
    <body>
        <div class="container">
            <h1>OpenFileSystem Demonstration Page</h1>
            <p>This page serves as an example of how you can use the OpenFileSystem api to interact with cloud file sources using entirely client-side javascript. To try it out, authorize one of the providers below:</p>
            <div class="vspace1em">&nbsp;</div>
            <div class="row">
                <div class="col-md-4">
                    <button id="auth-box" type="button" class="service-button btn btn-primary btn-lg">
                        Box
                    </button>
                </div>
                <div class="col-md-4">
                    <button type="button" class="service-button btn btn-primary btn-lg" disabled>
                        Google Drive
                    </button>
                </div>
                <div class="col-md-4">
                    <button type="button" class="service-button btn btn-primary btn-lg" disabled>
                        Dropbox
                    </button>
                </div>
            </div>
            <hr/>
            <p class="alert alert-info" id="auth-message">Not yet authorized for any client</p>
            <h2 id="path"></h2>
            <div id="directory-contents">
                <div id="loading-progress" style="display:none" class="progress progress-striped active">
                  <div id="loading-progress-bar" class="progress-bar" style="width: 5%"></div>
                </div>
            </div>
        </div>
    </body>
</html>
